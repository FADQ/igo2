<igo-list [navigation]="true">
  <ng-container *ngIf="!store.empty">
    <ng-template
      #groupTemplate
      ngFor let-group let-i="index"
      [ngForOf]="(store.observable | async).sort(sortByOrder) | searchEntityGroup">

      <igo-collapsible
        title="{{group.source.title}} ({{group.entities.length}})"
        *ngIf="mode === displayMode.Grouped; else flatTemplate">
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {entity: group.entity}"></ng-container>
      </igo-collapsible>

      <ng-template #flatTemplate>
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {entity: group.entity}"></ng-container>
      </ng-template>

      <ng-template #storeItemTemplate>
        <ng-template ngFor let-entity let-j="index" [ngForOf]="group.entities">
          <fadq-search-results-item
            igoListItem
            color="accent"
            [entity]="entity"
            [focused]="store.getEntityState(entity).focused"
            [selected]="store.getEntityState(entity).selected"
            (focus)="focusEntity(entity)"
            (select)="selectEntity(entity)"
            (unfocus)="unfocus.emit(entity)"
            (unselect)="unselect.emit(entity)">
          </fadq-search-results-item>
        </ng-template>
      </ng-template>

    </ng-template>

  </ng-container>
</igo-list>
