<igo-list [navigation]="true">
  <ng-container *ngIf="!store.empty">
    <ng-template
      #groupTemplate
      ngFor let-group let-i="index"
      [ngForOf]="(store.records$ | async).sort(sortByOrder) | recordGroup">

      <igo-collapsible
        title="{{group.source.title}} ({{group.records.length}})"
        *ngIf="mode === displayMode.Grouped; else flatTemplate">
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {record: group.record}"></ng-container>
      </igo-collapsible>

      <ng-template #flatTemplate>
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {record: group.record}"></ng-container>
      </ng-template>

      <ng-template #storeItemTemplate>
        <ng-template ngFor let-record let-j="index" [ngForOf]="group.records">
          <fadq-search-results-item
            igoListItem
            color="accent"
            [record]="record"
            [focused]="store.getRecordState(record).focused"
            [selected]="store.getRecordState(record).selected"
            (focus)="focusRecord(record)"
            (select)="selectRecord(record)"
            (unfocus)="unfocus.emit(record)"
            (unselect)="unselect.emit(record)">
          </fadq-search-results-item>
        </ng-template>
      </ng-template>

    </ng-template>

  </ng-container>
</igo-list>
