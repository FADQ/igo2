<igo-list [navigation]="true">
  <ng-container *ngIf="!store.empty">
    <ng-template
      #groupTemplate
      ngFor let-group let-i="index"
      [ngForOf]="(store.rawObservable | async).sort(sortByOrder) | searchResultsGroup">

      <igo-collapsible
        title="{{group.source.title}} ({{group.results.length}})"
        *ngIf="mode === displayMode.Grouped; else flatTemplate">
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {result: group.result}"></ng-container>
      </igo-collapsible>

      <ng-template #flatTemplate>
        <ng-container *ngTemplateOutlet="storeItemTemplate; context: {result: group.result}"></ng-container>
      </ng-template>

      <ng-template #storeItemTemplate>
        <ng-template ngFor let-result let-j="index" [ngForOf]="group.results">
          <fadq-search-results-item
            igoListItem
            color="accent"
            [result]="result"
            [focused]="store.getEntityState(result).focused"
            [selected]="store.getEntityState(result).selected"
            (focus)="onResultFocused(result)"
            (select)="onResultSelected(result)">
          </fadq-search-results-item>
        </ng-template>
      </ng-template>

    </ng-template>

  </ng-container>
</igo-list>
